const ppc = require('./src').create('ZggTczYlGp8YEVWG1Pi7uaQ6nzORlQNR2oQP7cCI');

function getDetails(id, type) {
  return ppc.getAdditionalBillDetails(id, type)
    .then(data => data.results[0][type]);
}

function getSubjects(id) {
  return getDetails(id, 'subjects');
}

function getAmendments(id) {
  return getDetails(id, 'amendments');
}

function getMember(memberId) {
  return ppc.getMember(memberId)
    .then(data => data.results[0]);
}

function getCosponsors(id) {
  return getDetails(id, 'cosponsors')
    .then(cosponsors => cosponsors.map(cosponsor => cosponsor.cosponsor_id))
    .then(memberIds => Promise.all(memberIds.map(memberId => getMember(memberId))));
}

function get(id) {
  return Promise.all([
    ppc.getBill(id).then(data => data.results[0]),
    getSubjects(id),
    getAmendments(id),
    getCosponsors(id)
  ]).then(([bill, subjects, amendments, cosponsors]) => Object.assign(bill, {
    subjects,
    amendments,
    cosponsors
  }));
}

get('hr609')
  .then(results => {
    return results;
  });
// const states = require('./src/states');

// state-based
// ppc.getNomineesByState();
// ppc.getCurrentRepresentatives();
// ppc.getCurrentSenators();

// ppc.getCommitteeMembers();

// ppc.getVotesByDate();
// ppc.getRollCallVotes();
// ppc.getBillsByMember();
// ppc.getLeavingMembers();
// ppc.getVotes();
// ppc.getSenateNominationVotes();
// ppc.getNominees();
// ppc.getPartyCounts();
// ppc.getCommittees();
// ppc.getMemberComparison();
// ppc.getVotesByMember();
// ppc.getNewMembers();
// ppc.getMemberList();
// ppc.getAdditionalBillDetails();
// ppc.getBill();
// ppc.getRecentBills();

// Promise.all([
//   ppc.getCommittees('house'),
//   ppc.getCommittees('senate')
// ]).then(([house, senate]) => [
//   ...house.results[0].committees,
//   ...senate.results[0].committees
// ]).then(committees => {
//   return committees;
// });

